const fs = require('fs-extra');

async function structureChapters() {
    console.log('ğŸ“š ç« ç«‹ã¦ã®ä¸å‚™ã‚’ä¿®æ­£ã—ã€ç›®æ¬¡æ§‹é€ ã‚’æ•´ãˆã¾ã™...');

    const TARGET_FILE = '/Users/kino/Desktop/vibe_coding_master.md';
    let content = await fs.readFile(TARGET_FILE, 'utf8');

    // 1. æœ¬æ–‡å…ˆé ­ã®å¤§è¦‹å‡ºã—(H1)ã‚’å‰Šé™¤ï¼ˆç›®æ¬¡é‡è¤‡é˜²æ­¢ï¼‰
    // å‰å›ã®å‡¦ç†ã§æ—¢ã«æ¶ˆãˆã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ãŒã€å¿µã®ãŸã‚
    content = content.replace(/^# ã€å®Œå…¨ç„¡æ–™ã€‘åˆå¿ƒè€…å‘ã‘Vibe Codingå…¥é–€\n/m, '');

    // 2. ç¬¬9ç«  Q&A ã‚’æŒ¿å…¥
    // ### Q1... ã®ç›´å‰ã« ## ç¬¬9ç« ... ã‚’æŒ¿å…¥
    // ãŸã ã—ã€æ—¢ã«æŒ¿å…¥æ¸ˆã¿ã§ãªã„ã‹ç¢ºèªã™ã‚‹
    if (!content.includes('## ç¬¬9ç« ')) {
        content = content.replace(/(### Q1\.)/g, '\n## ç¬¬9ç«  FAQï¼ˆã‚ˆãã‚ã‚‹è³ªå•ï¼‰\n\n$1');
    }

    // 3. ç¬¬10ç«  AFTER 10 ã‚’æŒ¿å…¥
    // ### 10.1... ã®ç›´å‰ã« ## ç¬¬10ç« ... ã‚’æŒ¿å…¥
    if (!content.includes('## ç¬¬10ç« ')) {
        content = content.replace(/(### 10\.1 0åœ°ç‚¹ã®å†ç¢ºèª)/g, '\n## ç¬¬10ç«  AFTER 10ï¼ˆæ¬¡ã®ä¸–ç•Œã¸ï¼‰\n\n$1');
    }

    // 4. AI Rules ãŒç›®æ¬¡ã«ã€Œ7.ã€ã¨ã—ã¦å‡ºã¦ã„ã‚‹å•é¡Œ
    // å‰å›ã®ä¿®æ­£ã§ `> **AI Rules...**` ã«ã—ãŸã¯ãšã ãŒã€ã‚‚ã— `## AI Rules` ãŒæ®‹ã£ã¦ã„ãŸã‚‰ã€
    // ã“ã“ã§å®Œå…¨ã«ãŸã ã®å¼·èª¿ãƒ†ã‚­ã‚¹ãƒˆã«å¤‰æ›ã—ã¦ã€ç›®æ¬¡ã‹ã‚‰æ¶ˆã™
    content = content.replace(/^## AI Rules/gm, '**AI Rules**');

    // 5. ç›®æ¬¡ã®ã€Œ1. 2. 3.ã€ã¨ã„ã†ç•ªå·ã«ã¤ã„ã¦
    // ã“ã‚Œã¯CSSã§æ¶ˆã™ãŒã€PandocãŒå‹æ‰‹ã«ã¤ã‘ã‚‹ç•ªå·ã‚¯ãƒ©ã‚¹ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œãªã„
    // Markdownè‡ªä½“ã«ãƒªã‚¹ãƒˆç•ªå·ï¼ˆ1. ï¼‰ãŒã¤ã„ã¦ã„ã‚‹ã‚ã‘ã§ã¯ãªã„ã®ã§ã€CSS/HTMLå´ã®å•é¡Œã€‚
    // CSSã¯æ›´æ–°æ¸ˆã¿ã€‚

    // 6. èª¤ã£ãŸå¼•ç”¨ãƒ–ãƒ­ãƒƒã‚¯ã®è§£é™¤ï¼ˆå¿µã®ãŸã‚å†å®Ÿè¡Œï¼‰
    content = content.replace(/^> ?(#{1,6} .*)/gm, '$1');

    await fs.writeFile(TARGET_FILE, content, 'utf8');
    console.log('âœ… ç« ç«‹ã¦æ§‹é€ ã®ä¿®æ­£å®Œäº†');
}

structureChapters().catch(console.error);
