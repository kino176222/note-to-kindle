const fs = require('fs-extra');

async function refinePromptFormatting() {
    console.log('ğŸ§¹ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¡¨è¨˜ã®å¾®èª¿æ•´ï¼ˆ**ã®ç¯„å›²ä¿®æ­£ï¼‰ã‚’è¡Œã„ã¾ã™...');

    const TARGET_FILE = '/Users/kino/Desktop/vibe_coding_master.md';
    let content = await fs.readFile(TARGET_FILE, 'utf8');

    // 1. **ã€ã‚³ãƒ”ãƒšç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ**ã€‘ ã®ã‚ˆã†ãªè¨˜è¿°ã‚’ **ã€ã‚³ãƒ”ãƒšç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã€‘** ã«ä¿®æ­£
    // ãƒ‘ã‚¿ãƒ¼ãƒ³: \*\*ã€(.+?)\*\*ã€‘ -> **ã€$1ã€‘**

    content = content.replace(/\*\*ã€(.+?)\*\*ã€‘/g, '**ã€$1ã€‘**');

    // é€†ã« **ã€ã‚³ãƒ”ãƒšç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã€‘** ã«ãªã£ã¦ã„ã‚‹ãŒã€
    // ã‚‚ã— ** ãŒä¸­é€”åŠç«¯ã«ã‚ã‚‹å ´åˆã‚‚ã‚±ã‚¢ã€‚

    // 2. ã‚‚ã—ä»–ã«ã‚‚ ### ãŒæ®‹ã£ã¦ã„ã‚‹å¤‰ãªç®‡æ‰€ãŒã‚ã‚Œã°æ¶ˆã™
    // ã•ã£ãã® grep ã§ã¯å¤§ä¸ˆå¤«ã ã£ãŸãŒã€å¿µã®ãŸã‚
    // "### ã€" ã¨ã„ã†ä¸¦ã³ï¼ˆé–“ã«ã‚¹ãƒšãƒ¼ã‚¹ã‚ã£ã¦ã‚‚ï¼‰ã¯ã€è¦‹å‡ºã—(1.2ã¨ã‹)ä»¥å¤–ãªã‚‰æ¶ˆã™ã€‚
    // è¦‹å‡ºã—ã¯ "### 1.1" ã¨ã‹ "### ç¬¬1ç« " ã¨ã‹æ•°å­—ã‚„æ¼¢å­—ãŒç¶šãã€‚
    // "### ã€" ã¨ã„ããªã‚‹æ¥ã‚‹ã®ã¯ã‚³ãƒ”ãƒšãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç³»ã ã‘ã®ã¯ãšï¼Ÿ
    // ä¾‹å¤–: "### 1.3 ã€é‡è¦ã€‘" -> ã“ã‚Œã¯æ¶ˆã—ã¡ã‚ƒãƒ€ãƒ¡ã€‚

    // æ­£è¦è¡¨ç¾: è¡Œé ­ã«ã‚ã‚‹ "### ã€" ã‚ã‚‹ã„ã¯ "###ã€€ã€" ã‚’æ¶ˆã™ã€‚
    // æ•°å­—ãŒç›´å¾Œã«æ¥ãªã„å ´åˆã®ã¿ã€‚

    // è¡Œé ­(ã¾ãŸã¯ã‚¹ãƒšãƒ¼ã‚¹å¾Œ) ### ã‚¹ãƒšãƒ¼ã‚¹* ã€
    // ãŸã ã—ã€### ã®å¾Œã« æ•°å­—+ãƒ‰ãƒƒãƒˆ ãŒæ¥ã‚‹å ´åˆã¯ç„¡è¦–ã€‚
    // \d+\. ã‚’å¦å®šå…ˆèª­ã¿ã§ãƒã‚§ãƒƒã‚¯ï¼Ÿ

    // content = content.replace(/(^|\n)###\s*(?!.*\d+\.)(?=ã€)/g, '$1');
    // ã¡ã‚‡ã£ã¨æ€–ã„ã®ã§ã€æ˜ç¤ºçš„ã« "ã€ã‚³ãƒ”ãƒš" ã‚„ "ã€ãƒã‚¤ãƒ³ãƒˆ" ã®å‰ã ã‘æ¶ˆã™

    content = content.replace(/###\s*(?=ã€ã‚³ãƒ”ãƒš)/g, '');
    content = content.replace(/###\s*(?=ã€ãƒã‚¤ãƒ³ãƒˆ)/g, '');
    content = content.replace(/###\s*(?=ã€OKã€‘)/g, '');

    // 3. AI Rulesã®å¾®èª¿æ•´ï¼ˆå¿µã®ãŸã‚ï¼‰
    // User provided image showed "AI Rules & Guidelines" title text.
    // Ensure it is bold or H2? ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”»åƒã¯ H2 ã£ã½ã„ï¼Ÿ
    // å…ƒã®ãƒ†ã‚­ã‚¹ãƒˆã¯ "> > > > **AI Rules..."
    // ä»Šå›ã® fix_ai_rules_and_hashes.js ã§ "> **AI Rules..." ã«ãªã£ãŸã€‚
    // å¼•ç”¨ã®ä¸­ã®å¤ªå­—ã€‚ã“ã‚Œã§OKã€‚

    await fs.writeFile(TARGET_FILE, content, 'utf8');
    console.log('âœ… ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¡¨è¨˜ã® ** ä½ç½®ã‚’ä¿®æ­£ã—ã¾ã—ãŸ');
}

refinePromptFormatting().catch(console.error);
