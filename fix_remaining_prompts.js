const fs = require('fs-extra');

async function fixRemainingPrompts() {
    console.log('ğŸ•µï¸â€â™€ï¸ æ®‹ã‚Šã®éš ã‚Œãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä¸€æ–‰æ¤œæŒ™ã—ã¾ã™...');

    const TARGET_FILE = '/Users/kino/Desktop/vibe_coding_master.md';
    let content = await fs.readFile(TARGET_FILE, 'utf8');

    // 1. ruby > ä»Šã‹ã‚‰ GitHub ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²ã‚’ã—ã¾ã™...
    // ç”»åƒã‚’è¦‹ã‚‹ã¨ã€"ruby > " ã§å§‹ã¾ã‚Šã€ãã®å¾Œã«æ”¹è¡Œã‚’æŒŸã‚“ã§ "è‹±èªã®ç”»é¢ãŒå‡ºãŸã‚‰..." ãŒã‚ã‚‹ã€‚
    // ã“ã‚Œã‚‰ã‚’ã¾ã¨ã‚ã¦ä¸€ã¤ã®å¼•ç”¨ãƒ–ãƒ­ãƒƒã‚¯ã«ã™ã‚‹ã€‚

    const pattern1 = 'ruby > ä»Šã‹ã‚‰ GitHub ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²ã‚’ã—ã¾ã™ã€‚ç§ã¯åˆå¿ƒè€…ãªã®ã§ã€è¡¨ç¤ºã•ã‚Œã‚‹ç”»é¢ã®æ„å‘³ã‚„ æ¬¡ã«ä½•ã‚’å…¥åŠ›ãƒ»ã‚¯ãƒªãƒƒã‚¯ã™ã‚Œã°ã„ã„ã‹ã‚’ é †ç•ªã«ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚\n\nè‹±èªã®ç”»é¢ãŒå‡ºãŸã‚‰ã€ã‚¹ã‚¯ã‚·ãƒ§ã‚’è²¼ã‚‹ã®ã§ ãã®éƒ½åº¦ã€åˆ†ã‹ã‚Šã‚„ã™ãèª¬æ˜ã—ã¦ãã ã•ã„ã€‚';

    // æ­£è¦è¡¨ç¾ã§æŸ”è»Ÿã«ãƒãƒƒãƒã•ã›ã‚‹ï¼ˆã‚¹ãƒšãƒ¼ã‚¹ã‚„æ”¹è¡Œã®å¾®å¦™ãªé•ã„ã‚’å¸åï¼‰
    // ç‰¹æ®Šæ–‡å­—ã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
    const escapeRegExp = (string) => string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');

    // ãƒ‘ã‚¿ãƒ¼ãƒ³1ã®ç½®æ›
    // å®Œå…¨ã«ä¸€è‡´ã™ã‚‹ã‹ç¢ºèªã—ã¦ã‹ã‚‰ç½®æ›ã€ã‚ã‚‹ã„ã¯éƒ¨åˆ†ä¸€è‡´ã§æŸ”è»Ÿã«ã€‚
    // ã“ã“ã¯å°‘ã—å®‰å…¨ã«ã€å‰åŠéƒ¨åˆ†ã¨å¾ŒåŠéƒ¨åˆ†ã‚’æ¢ã—ã¦ã€ãã®é–“ã‚‚å¼•ç”¨ã«ã™ã‚‹ã€‚

    content = content.replace(
        /ruby > ä»Šã‹ã‚‰ GitHub ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²ã‚’ã—ã¾ã™ã€‚[\s\S]*?èª¬æ˜ã—ã¦ãã ã•ã„ã€‚/g,
        (match) => {
            // "ruby > " ã‚’å‰Šé™¤ã—ã€å„è¡Œã®å…ˆé ­ã« "> " ã‚’ã¤ã‘ã‚‹
            let clean = match.replace(/^ruby > /, '').replace(/^ruby /, '');
            return '> ' + clean.replace(/\n/g, '\n> ');
        }
    );

    // 2. ruby ã“ã‚Œã‹ã‚‰GitHubã¸ã®ãƒ—ãƒƒã‚·ãƒ¥ã‚‚AIã«ä»»ã›ãŸã„ã§ã™...
    content = content.replace(
        /ruby ã“ã‚Œã‹ã‚‰GitHubã¸ã®ãƒ—ãƒƒã‚·ãƒ¥ã‚‚AIã«ä»»ã›ãŸã„ã§ã™ã€‚[\s\S]*?y\/n ã§ç¢ºèªã—ã¦ãã ã•ã„ã€‚/g,
        (match) => {
            let clean = match.replace(/^ruby /, '');
            return '> ' + clean.replace(/\n/g, '\n> ');
        }
    );

    // 3. ruby ä»Šå›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’GitHubã«ãƒ—ãƒƒã‚·ãƒ¥ã—ãŸã„ã§ã™ã€‚
    content = content.replace(
        /ruby ä»Šå›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’GitHubã«ãƒ—ãƒƒã‚·ãƒ¥ã—ãŸã„ã§ã™ã€‚/g,
        '> ä»Šå›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’GitHubã«ãƒ—ãƒƒã‚·ãƒ¥ã—ãŸã„ã§ã™ã€‚'
    );

    // 4. ä½œã£ãŸã‚¢ãƒ—ãƒªã‚’å…¨ä¸–ç•Œã«å…¬é–‹ã—ãŸã„ã§ã™ã€‚ Vercelã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’...
    // rubyãªã—ãƒ‘ã‚¿ãƒ¼ãƒ³
    content = content.replace(
        /ä½œã£ãŸã‚¢ãƒ—ãƒªã‚’å…¨ä¸–ç•Œã«å…¬é–‹ã—ãŸã„ã§ã™ã€‚ Vercelã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚/g,
        '> ä½œã£ãŸã‚¢ãƒ—ãƒªã‚’å…¨ä¸–ç•Œã«å…¬é–‹ã—ãŸã„ã§ã™ã€‚ Vercelã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚'
    );

    // å¿µã®ãŸã‚ã€ä»–ã® "ruby " å§‹ã¾ã‚Šã‚‚æ±ç”¨çš„ã«å‡¦ç†
    // ãŸã ã— "ruby" ã¨ã„ã†å˜èªãŒæ–‡ç« ä¸­ã«æ™®é€šã«å‡ºã¦ãã‚‹å¯èƒ½æ€§ã¯ä½ã„ãŒã€å¿µã®ãŸã‚è¡Œé ­ã®ã¿ã€‚
    content = content.replace(/^ruby (.*)$/gm, '> $1');
    content = content.replace(/^ruby > (.*)$/gm, '> $1');

    await fs.writeFile(TARGET_FILE, content, 'utf8');
    console.log('âœ… ã™ã¹ã¦ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå€™è£œã‚’æ›´ç”Ÿã•ã›ã¾ã—ãŸ');
}

fixRemainingPrompts().catch(console.error);
