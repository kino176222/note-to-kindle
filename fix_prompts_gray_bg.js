const fs = require('fs-extra');

async function fixPromptsGrayBg() {
    console.log('ğŸ§¹ æ®‹ã£ã¦ã„ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ã‚­ã‚¹ãƒˆã‚’å¼•ç”¨ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆã‚°ãƒ¬ãƒ¼èƒŒæ™¯ï¼‰åŒ–ã—ã¾ã™...');

    const TARGET_FILE = '/Users/kino/Desktop/vibe_coding_master.md';
    let content = await fs.readFile(TARGET_FILE, 'utf8');

    // 1. Node.jsã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
    // å‰å¾Œã®æ–‡è„ˆã‚’å«ã‚ã¦æ¤œç´¢ç½®æ›
    const nodePromptStart = "Webé–‹ç™ºã‚’ã—ãŸã„ã®ã§ã€ã€Node.jsã€ç­‰ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’æ‰‹ä¼ã£ã¦ãã ã•ã„ã€‚";
    const nodePromptEnd = "ä¸è¦ãƒ»å¾Œå›ã—å¯èƒ½ãªã‚‚ã®ã¯ã€ãã®æ—¨ã‚‚æ•™ãˆã¦ãã ã•ã„ã€‚";

    const nodeBlock = `> Webé–‹ç™ºã‚’ã—ãŸã„ã®ã§ã€ã€Node.jsã€ç­‰ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’æ‰‹ä¼ã£ã¦ãã ã•ã„ã€‚
> 
> ç§ã®ç’°å¢ƒã«åˆã‚ã›ã¦ã€ã¾ãšã¯ä¸€ç•ªç°¡å˜ã§ç¢ºå®Ÿãªæ–¹æ³•ã‚’ãƒŠãƒ“ã‚²ãƒ¼ãƒˆã—ã¦ãã ã•ã„ã€‚
> ä½œæ¥­å‰ã« y/n ã§ç¢ºèªã—ã¦ãã ã•ã„ã€‚
> 
> ä¸è¦ãƒ»å¾Œå›ã—å¯èƒ½ãªã‚‚ã®ã¯ã€ãã®æ—¨ã‚‚æ•™ãˆã¦ãã ã•ã„ã€‚`;

    if (content.indexOf(nodePromptStart) !== -1) {
        // éƒ¨åˆ†ä¸€è‡´ã§ã¯ãªãã€ç¯„å›²ã§ç½®æ›ã—ãŸã„ãŒã€æ”¹è¡Œã‚³ãƒ¼ãƒ‰ç­‰ãŒä¸å®‰ãªã®ã§
        // replaceä¸€ç™ºã§ã„ã‘ã‚‹ã‹è©¦ã™ã€‚
        // å˜ç´”ãªreplaceã ã¨ã€é–“ã®æ”¹è¡Œãªã©ãŒå®Œå…¨ã«ä¸€è‡´ã—ãªã„ã¨ãƒ€ãƒ¡ã€‚
        // å…ˆã»ã©ã® grep output ã‚’å‚è€ƒã«ã™ã‚‹ã¨ã€é–“ã«ç©ºè¡ŒãŒã‚ã‚‹ã€‚

        // æ­£è¦è¡¨ç¾ã§ç¯„å›²é¸æŠ
        // Webé–‹ç™º... [\s\S]*? ...æ•™ãˆã¦ãã ã•ã„ã€‚
        const regexNode = /Webé–‹ç™ºã‚’ã—ãŸã„ã®ã§ã€ã€Node\.jsã€ç­‰ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’æ‰‹ä¼ã£ã¦ãã ã•ã„ã€‚[\s\S]*?ä¸è¦ãƒ»å¾Œå›ã—å¯èƒ½ãªã‚‚ã®ã¯ã€ãã®æ—¨ã‚‚æ•™ãˆã¦ãã ã•ã„ã€‚/;

        if (regexNode.test(content)) {
            content = content.replace(regexNode, nodeBlock);
            console.log('âœ… Node.jsãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å¼•ç”¨ãƒ–ãƒ­ãƒƒã‚¯åŒ–ã—ã¾ã—ãŸ');
        } else {
            console.warn('âš ï¸ Node.jsãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸï¼ˆæ­£è¦è¡¨ç¾ä¸ä¸€è‡´ï¼‰');
        }
    }

    // 2. ä½œæ¥­ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
    const folderPromptStart = "Antigravityã§ä½œæ¥­ï¼ˆVibe Codingï¼‰ã‚’ã™ã‚‹ãŸã‚ã«ã€";
    const folderPromptEnd = "ç”»é¢æ“ä½œã ã‘ã§ä½œã‚‹æ‰‹é †ã‚’èª¬æ˜ã—ã¦ãã ã•ã„ã€‚";

    const folderBlock = `> Antigravityã§ä½œæ¥­ï¼ˆVibe Codingï¼‰ã‚’ã™ã‚‹ãŸã‚ã«ã€
> å°‚ç”¨ã®ä½œæ¥­ãƒ•ã‚©ãƒ«ãƒ€ã‚’è‡ªåˆ†ã§ä½œã‚ŠãŸã„ã§ã™ã€‚
> 
> iCloudãƒ»OneDrive ãªã©ã® åŒæœŸãƒ•ã‚©ãƒ«ãƒ€ã‚’é¿ã‘ã¦ã€
> Windows / Mac ãã‚Œãã‚Œã§å®‰å…¨ãªå ´æ‰€ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚
> 
> ã‚³ãƒãƒ³ãƒ‰ã¯ä½¿ã‚ãšã€
> ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ï¼ˆWindowsï¼‰ã‚„ Finderï¼ˆMacï¼‰ãªã©ã€
> ç”»é¢æ“ä½œã ã‘ã§ä½œã‚‹æ‰‹é †ã‚’èª¬æ˜ã—ã¦ãã ã•ã„ã€‚`;

    const regexFolder = /Antigravityã§ä½œæ¥­ï¼ˆVibe Codingï¼‰ã‚’ã™ã‚‹ãŸã‚ã«ã€[\s\S]*?ç”»é¢æ“ä½œã ã‘ã§ä½œã‚‹æ‰‹é †ã‚’èª¬æ˜ã—ã¦ãã ã•ã„ã€‚/;

    if (regexFolder.test(content)) {
        content = content.replace(regexFolder, folderBlock);
        console.log('âœ… ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å¼•ç”¨ãƒ–ãƒ­ãƒƒã‚¯åŒ–ã—ã¾ã—ãŸ');
    } else {
        console.warn('âš ï¸ ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ');
    }

    // 3. Vercelå…¬é–‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
    // grepçµæœ: 2307:ä½œã£ãŸã‚¢ãƒ—ãƒªã‚’å…¨ä¸–ç•Œã«å…¬é–‹ã—ãŸã„ã§ã™ã€‚
    // ãã®å¾Œã‚: Vercelã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚

    const vercelBlock = `> ä½œã£ãŸã‚¢ãƒ—ãƒªã‚’å…¨ä¸–ç•Œã«å…¬é–‹ã—ãŸã„ã§ã™ã€‚
> Vercelã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚`;

    const regexVercel = /ä½œã£ãŸã‚¢ãƒ—ãƒªã‚’å…¨ä¸–ç•Œã«å…¬é–‹ã—ãŸã„ã§ã™ã€‚[\s\S]*?Vercelã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚/;

    if (regexVercel.test(content)) {
        content = content.replace(regexVercel, vercelBlock);
        console.log('âœ… Vercelå…¬é–‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å¼•ç”¨ãƒ–ãƒ­ãƒƒã‚¯åŒ–ã—ã¾ã—ãŸ');
    } else {
        console.warn('âš ï¸ Vercelå…¬é–‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ');
    }

    await fs.writeFile(TARGET_FILE, content, 'utf8');
}

fixPromptsGrayBg().catch(console.error);
