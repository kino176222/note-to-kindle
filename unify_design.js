const fs = require('fs-extra');

async function unifyDesignAndFixLayout() {
    console.log('ðŸŽ¨ ãƒ‡ã‚¶ã‚¤ãƒ³çµ±ä¸€ã¨ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆä¿®æ­£ã‚’é–‹å§‹ã—ã¾ã™...');

    const TARGET_FILE = '/Users/kino/Desktop/vibe_coding_master.md';
    let content = await fs.readFile(TARGET_FILE, 'utf8');

    // 1. æ®‹ã£ã¦ã„ã‚‹ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯è¨˜æ³• ```ruby ... ``` ãªã©ã‚’å…¨ã¦ å¼•ç”¨ > ã«å¤‰æ›
    // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å…¨ã¦åŒã˜ã‚°ãƒ¬ãƒ¼ãƒœãƒƒã‚¯ã‚¹ãƒ‡ã‚¶ã‚¤ãƒ³ï¼ˆå¼•ç”¨ã‚¹ã‚¿ã‚¤ãƒ«ï¼‰ã«ã™ã‚‹ãŸã‚

    // ãƒ‘ã‚¿ãƒ¼ãƒ³: ```(è¨€èªžå)?\n(ä¸­èº«)\n```
    content = content.replace(/```[a-zA-Z]*\n([\s\S]*?)\n```/g, (match, code) => {
        // å„è¡Œã®é ­ã« > ã‚’ã¤ã‘ã‚‹
        return code.split('\n').map(line => `> ${line}`).join('\n') + '\n';
    });

    // 2. AI Rulesã®å´©ã‚Œã‚’ä¿®æ­£
    // ç¾çŠ¶: AI Rules... ã®ã‚ãŸã‚ŠãŒæ–‡å­—åŒ–ã‘ã—ã¦ã„ã‚‹
    // ã“ã‚Œã‚‚å…¨ã¦ã€Œå¼•ç”¨ãƒ–ãƒ­ãƒƒã‚¯ã€ã«å…¥ã‚Œã¦ã—ã¾ã†ã“ã¨ã§ã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¨åŒã˜ãƒ‡ã‚¶ã‚¤ãƒ³ã§çµ±ä¸€ã™ã‚‹
    // AI Rulesã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç‰¹å®š

    // AI Rulesã¨ã„ã†è¦‹å‡ºã—ã‹ã‚‰æ¬¡ã®è¦‹å‡ºã—ã¾ã§ã‚’å–å¾—ã—ã¦ã€å…¨è¡Œå¼•ç”¨ã«ã™ã‚‹æ‰‹ã‚‚ã‚ã‚‹ãŒ
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”»åƒã‚’ã¿ã‚‹ã¨ "AI Rules & Guidelines..." ã¨ã„ã†è¡ŒãŒãã®ã¾ã¾ãƒ†ã‚­ã‚¹ãƒˆã«ãªã£ã¦ã„ã‚‹
    // è¦‹å‡ºã—è¨˜å· # ãŒæ¶ˆãˆã¦ã—ã¾ã£ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹

    // "AI Rules & Guidelines" ã§å§‹ã¾ã‚‹è¡Œã‚’æŽ¢ã—ã€ãã“ã‹ã‚‰ä¸€å®šã®ç¯„å›²ã€ã¾ãŸã¯æ¬¡ã®å¤§ããªã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¾ã§ã‚’å¼•ç”¨åŒ–
    // ãŸã ã—ã€AI Rulesã¯é•·ã„ã®ã§ã€å…¨ä½“ã‚’1ã¤ã®å¼•ç”¨ã«ã™ã‚‹ã®ã§ã¯ãªãã€
    // å„é …ç›®ã‚’ãƒªã‚¹ãƒˆåŒ–ã™ã‚‹ã‹ã€ã‚ã‚‹ã„ã¯å…¨ä½“ã‚’å›²ã‚€divã«ã™ã‚‹ã‹ã€‚
    // User Reset: "ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ã¨ã“ã‚ã¯åŒã˜ãƒ‡ã‚¶ã‚¤ãƒ³ã§çµ±ä¸€ã—ã¦ã»ã—ã„"
    // -> AI Rulesã‚‚ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¨åŒã˜ã‚°ãƒ¬ãƒ¼ãƒœãƒƒã‚¯ã‚¹ã«å…¥ã‚ŒãŸã„ã¨è§£é‡ˆ

    // AI Rulesã®é–‹å§‹è¡Œã‚’è¦‹ã¤ã‘ã‚‹
    const aiRulesStart = content.indexOf('AI Rules & Guidelines');
    if (aiRulesStart !== -1) {
        // AI Rulesã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®çµ‚ã‚ã‚Šã‚’è¦‹ã¤ã‘ã‚‹ï¼ˆä¾‹: "ç¬¬xç« ..." ã‚„ "---" ãªã©ï¼‰
        // ã“ã“ã§ã¯ç°¡æ˜“çš„ã«ã€"###" ã‚„ "##" ãŒå¾©æ´»ã—ã¦ã„ã‚‹ã“ã¨ã‚’æœŸå¾…ã—ã¤ã¤ã€
        // ã‚‚ã—ãƒžãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³è¨˜æ³•ãŒå£Šã‚Œã¦ãƒ†ã‚­ã‚¹ãƒˆã ã‘ãªã‚‰ã€æ‰‹å‹•ã§æ•´å½¢ãŒå¿…è¦ã€‚

        // ç”»åƒã‚’è¦‹ã‚‹é™ã‚Šã€Markdownè¨˜æ³•ãŒãã®ã¾ã¾ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦å‡ºã¦ã„ã‚‹ï¼ˆ\- ãƒ«ãƒ¼ãƒ«: ...ï¼‰
        // ãªã®ã§ã€ãã‚Œã‚‰ã‚’ç¶ºéº—ãªãƒªã‚¹ãƒˆã«å¾©å…ƒã™ã‚‹

        // " -ãƒ«ãƒ¼ãƒ«:" -> "- **ãƒ«ãƒ¼ãƒ«**:"
        content = content.replace(/ -ãƒ«ãƒ¼ãƒ«:/g, '\n- **ãƒ«ãƒ¼ãƒ«**:');
        content = content.replace(/ -æ‰‹é †:/g, '\n- **æ‰‹é †**:');
        content = content.replace(/ -ç›®çš„:/g, '\n- **ç›®çš„**:');

        // AI Ruleså…¨ä½“ã‚’å¼•ç”¨åŒ–ã™ã‚‹ã®ã¯æ§‹é€ çš„ã«åŽ³ã—ã„ã‹ã‚‚ã—ã‚Œãªã„ãŒã€
        // å°‘ãªãã¨ã‚‚ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯æ®‹éª¸ï¼ˆruby ...ï¼‰ã¯æ¶ˆãˆãŸã¯ãšã€‚
    }

    // 3. å…·ä½“çš„ãª "ruby Antigravity..." ã®ã‚ˆã†ãªèª¤è¡¨ç¤ºã¸ã®å¯¾å‡¦
    content = content.replace(/ruby Antigravity/g, 'Antigravity');

    // 4. "â–  ã‚³ãƒ”ãƒšç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ" ãªã©ã‚’æ•´å½¢
    content = content.replace(/â–  (.*)/g, '### ã€$1ã€‘');

    // 5. ã‚´ãƒŸæŽƒé™¤ï¼ˆé€£ç¶šã™ã‚‹å¼•ç”¨è¨˜å·ãªã©ï¼‰
    content = content.replace(/> >/g, '>');

    await fs.writeFile(TARGET_FILE, content, 'utf8');
    console.log('âœ… ãƒ‡ã‚¶ã‚¤ãƒ³çµ±ä¸€ãƒ»ä¿®æ­£å®Œäº†');
}

unifyDesignAndFixLayout().catch(console.error);
